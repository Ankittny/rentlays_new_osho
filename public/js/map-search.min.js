"use strict";

function addMarker(t, e) {
	for (var a = new google.maps.InfoWindow, o = 0; s = e[o]; o++) {
		var s = new google.maps.Marker({
			position: new google.maps.LatLng(s.latitude, s.longitude),
			icon: void 0 !== s.icon ? s.icon : void 0,
			map: t,
			title: void 0 !== s.title ? s.title : void 0,
			content: void 0 !== s.content ? s.content : void 0
		});
		markers.push(s), google.maps.event.addListener(s, "click", function(e) {
			this.content && (a.setContent(this.content), a.open(t, this))
		})
	}
}

function setMapOnAll(e) {
	for (var t = 0; t < markers.length; t++) markers[t].setMap(e)
}

function clearMarkers() {
	setMapOnAll(null)
}

function deleteMarkers() {
	clearMarkers(), markers = []
}

function moneyFormat(e, t) {
	return "before" == symbolPosition ? e + " " + t : t + " " + e
}

function getProperties(m, e) {
	var t, a, o, s, i, l, r, n, c, d, g, h, u, p;
	loadPage && (e = e || "", t = null != (d = (a = m).getBounds()) ? (o = a.getZoom(), s = d.getSouthWest().lat(), i = d.getSouthWest().lng(), l = d.getNorthEast().lat(), r = d.getNorthEast().lng(), n = d.getCenter().lat(), c = d.getCenter().lng(), o + "~" + d + "~" + s + "~" + i + "~" + l + "~" + r + "~" + n + "~" + c) : "", map_loc = d, p = (p = $("#price-range").attr("data-value")).split(","), e = $("#front-search-field").val(), $("#header-search-form").val(e), a = p[0], o = p[1], $("#minPrice").html(a), $("#maxPrice").html(o), s = getCheckedValueArray("amenities"), i = getCheckedValueArray("property_type"), l = getCheckedValueArray("book_type"), r = getCheckedValueArray("space_type"), n = $("#map-search-min-beds").val(), c = $("#map-search-min-bathrooms").val(), d = $("#map-search-min-bedrooms").val(), g = $("#startDate").val(), h = $("#endDate").val(), u = $("#front-search-guests").val(), p = loadPage, "none" != $("#more_filters").css("display") && $.ajax({
		url: p,
		data: {
			_token: token,
			location: e,
			min_price: a,
			max_price: o,
			amenities: s,
			property_type: i,
			book_type: l,
			space_type: r,
			beds: n,
			bathrooms: c,
			bedrooms: d,
			checkin: g,
			checkout: h,
			guest: u,
			map_details: t
		},
		type: "post",
		dataType: "json",
		beforeSend: function() {
			$("#properties_show").html(""), show_loader()
		},
		success: function(e) {
			$("#page-total").html(e.total), $("#page-from").html(e.from), $("#page-to").html(e.to), allowRefresh = !1;
			var t = "";
			if (0 < e.total) {
				if (1 < e.current_page && (t += '<li class="page-item"><a class="page-data page-link" href="' + e.prev_page_url + '">Previous</a></li>'), e.current_page)
					for (var a = 1; a <= e.last_page; a++) e.current_page == a ? t += '<li class="page-item active"><a  href="' + APP_URL + "/search/result?page=" + a + '" class="page-data page-link">' + a + "</a></li>" : t += '<li class="page-item"><a  href="' + APP_URL + "/search/result?page=" + a + '" class="page-data page-link">' + a + "</a></li>";
				e.next_page_url && (t += '<li class="page-item"><a class="page-data page-link" href="' + e.next_page_url + '">Next</a></li>'), $("#pager").html(t), $("#pagination").removeClass("d-none")
			} else $("#pagination").addClass("d-none");
			var o, s, i, l, r, n, c = e.data,
				d = [],
				p = "";
			for (o in c) c.hasOwnProperty(o) && (d[o] = {
				latitude: c[o].property_address.latitude,
				longitude: c[o].property_address.longitude,
				title: c[o].name,
				content: '<a href="' + APP_URL + "/properties/" + c[o].slug + "?checkin=" + g + "&checkout=" + h + "&guests=" + u + '" class="media-cover" target="_blank"><img class="map-property-img" src="' + c[o].cover_photo + '"alt="' + c[o].name + '"></a><div class="map-property-name"><div class="col-xs-12 p-1"><div class="location-title"><h5>' + c[o].name + "</h5></div></div></div>"
			}, s = c[o].avg_rating, i = 0, (1 == c[o].reviews_count || 0 < c[o].reviews_count) && (i = c[o].reviews_count), l = moneyFormat(c[o].property_price.default_symbol, c[o].property_price.price), n = c[o].book_mark ? "#1dbf73" : "", r = $("#listCol").hasClass("col-md-7"), n = "" != user_id ? '<a class="btn btn-sm book_mark_change vvvv" data-status="' + c[o].book_mark + '" data-id="' + c[o].id + '" style="color:' + n + '"><span style="font-size: 22px;"><i class="fas fa-heart dtlhrtmt"></i></span></a>' : '<a class="btn btn-sm book_mark_change" data-status="' + c[o].book_mark + '" data-id="' + c[o].id + '" style="color:' + n + '"><span style="font-size: 22px;"><i class="fas fa-heart dtlhrtmt"></i></span></a>', p += 0 == r ? '<div class="col-md-6 col-lg-3 p-2 pl-4 pr-4 mt-4"><div class="card h-100 top-Destination topdestination"><div class="grid card-image mb-0"><a href="' + APP_URL + "/properties/" + c[o].slug + "?checkin=" + g + "&checkout=" + h + "&guests=" + u + '" target="_blank"><figure class="effect-milo serachraoundeCorner"><img src="' + c[o].cover_photo + '" class="room-image-container200  rounded  " alt="' + c[o].name + '"/><figcaption></figcaption></figure></a></div><div class="card-body p-0 pl-1 pr-1 px-3"><div class="d-flex">       <div class=" text d-flex justify-content-between"><div class="d-flex justify-content-between w-100"><a class="text-color text-color-hover" href="' + APP_URL + "/properties/" + c[o].slug + "?checkin=" + g + "&checkout=" + h + "&guests=" + u + '" target="_blank"> <span class="text-14 font-weight-700 w-100">'+c[o].property_type_name+'</span> <span class="text-14 font-weight-700 ">' + c[o].property_address.city + '</span></a> <div class="bnbnbn"><span><i class="fa fa-star text-14 secondary-text-color vvvvvv"></i> ' + s + " (" + i + ")</span> " + ' </div> </div> <div></div>  <div class="card-button imagebutton"><a class="btn btn-sm book_mark_change" data-status="' + c[o].book_mark + '" data-id="' + c[o].id + '" style="color:' + n + '<span style="font-size: 22px;"></i></span></a>  </div></div></div></div><div class="review-0 pricenightfont px-3 mb-3"><span class="">' + l + "</span> "  + '</div><div class="" style="display:none"><div class="d-flex bg-white justify-content-between pl-2 pr-2 pt-2 mb-3"></li>  ' +"</span></div></li></ul></div></div></div></div></div></div>" : '<div class="col-sm-6 col-md-12 col-lg-12  p-0 mb-4"><div class=" row  border p-2 rounded-3"><div class="col-lg-5 p-2"><div class="img-event">  <div class="card-button imagebutton"><a class="btn btn-sm book_mark_change" data-status="' + c[o].book_mark + '" data-id="' + c[o].id + '" style="color:' + n + '<span style="font-size: 22px;"></i></span></a></div> <a  href="' + APP_URL + "/properties/" + c[o].slug + "?checkin=" + g + "&checkout=" + h + "&guests=" + u + '" target="_blank"><img class="room-image-container200  rounded" src="' + c[o].cover_photo + '" alt="' + c[o].name + '"></a></div></div><div class="col-lg-7 p-2 heardHidCss"><div class="row justify-content-between"><div class="col-sm-12 pl-0"><a class="text-color text-color-hover" href="' + APP_URL + "/properties/" + c[o].slug + "?checkin=" + g + "&checkout=" + h + "&guests=" + u + '" target="_blank"> <span class="text-14 font-weight-700 w-100">'+c[o].property_type_name+'</span> <span class="text-14 font-weight-700 ">' + c[o].property_address.city + '</span></a></div></div><p class="text-14 mt-3 text-muted"><i class="fas fa-map-marker-alt"></i> ' + c[o].property_address.address_line_1 + '</p><div class="review-0 p-0"><div class="d-flex justify-content-between"><div class="d-flex align-items-center"><div class="d-flex"><span><i class="fa fa-star text-14 secondary-text-color"></i> ' + s + " (" + i + ")</span></div><div>" + n + '</div></div><div><span class="font-weight-700 text-18">' + l + "</span> /" + nightText + '</div></div></div> ' + "</div></div></div>");
			"" != p ? $("#properties_show").html(p) : $("#properties_show").html(' <div class="text-center justify-content-center w-100 position-center"><img src="' + notFoundImage + '" class="img-fluid not-found" alt="not-found"><h4 class="text-center text-20 font-weight-700">' + noResult + "</h4></div>"), addMarker(m, d)
		},
		error: function(e, t) {
			allowRefresh = !1
		},
		complete: function() {
			hide_loader()
		}
	}))
}

function getCheckedValueArray(e) {
	return $('input[name="' + e + '[]"]:checked').map(function() {
		return this.value
	}).get().join(",")
}
$(function() {
	var e = $("#startDate").val(),
		t = $("#endDate").val();
	dateRangeBtn(e, t, null, dateFormat)
}), $.fn.slider = null, $("#price-range").on("slideStop", function(e) {
	var t = $("#price-range").attr("data-value"),
		a = (t = t.split(","))[0],
		t = t[1];
	$("#minPrice").html(a), $("#maxPrice").html(t)
}), $("#header-search-form").on("change", function() {
	allowRefresh = !0, deleteMarkers(), getProperties($("#map_view").locationpicker("map").map)
}), $("#search-pg-checkin").datepicker({
	minDate: 0,
	onSelect: function(e) {
		var t = $("#search-pg-checkin").datepicker("getDate");
		t.setDate(t.getDate() + 1), $("#search-pg-checkout").datepicker("option", "minDate", t), setTimeout(function() {
			$("#search-pg-checkout").datepicker("show")
		}, 20), allowRefresh = !0, loadPage, getProperties($("#map_view").locationpicker("map").map)
	}
}), $("#search-pg-checkout").datepicker({
	dateFormat: dateFormat,
	minDate: 1,
	onClose: function() {
		var e = $("#checkin").datepicker("getDate");
		$("#header-search-checkout").datepicker("getDate") <= e && (e = $("#search-pg-checkout").datepicker("option", "minDate"), $("#search-pg-checkout").datepicker("setDate", e))
	},
	onSelect: function() {
		allowRefresh = !0, loadPage, getProperties($("#map_view").locationpicker("map").map)
	}
}), $(document.body).on("click", ".page-data", function(e) {
	e.preventDefault();
	e = $(this).attr("href");
	loadPage = e, allowRefresh = !0, getProperties($("#map_view").locationpicker("map").map, e)
}), $("#btnBook, #btnRoom, #btnPrice, .filter-apply").on("click", function() {
	allowRefresh = !0, deleteMarkers(), loadPage, getProperties($("#map_view").locationpicker("map").map), $(".room_filter").addClass("display-off"), $("#more_filters").show(), $(".dropdown-menu-price").removeClass("show")
}), $(document.body).on("click", "#map_view", function() {
	allowRefresh = !0, loadPage, getProperties($("#map_view").locationpicker("map").map)
});
var zoom = 12;

function show_loader() {
	$("#loader").removeClass("display-off"), $("#pagination").hide()
}

function hide_loader() {
	$("#loader").addClass("display-off"), $("#pagination").show()
}
screen.width < 1366 ? screen.height < 768 ? (zoom = 10, console.log("height")) : (zoom = 11, console.log("width")) : screen.height < 768 && (screen.width < 1366 ? (zoom = 11, console.log("width")) : (zoom = 10, console.log("height"))), $("#map_view").locationpicker({
	location: {
		latitude: latitude,
		longitude: longitude
	},
	radius: 0,
	zoom: zoom,
	addressFormat: "",
	markerVisible: !1,
	markerInCenter: !1,
	inputBinding: {
		latitudeInput: $("#latitude"),
		longitudeInput: $("#longitude"),
		locationNameInput: $("#address_line_1")
	},
	enableAutocomplete: !0,
	draggable: !0,
	onclick: function(e, t, a) {
		1 == allowRefresh && getProperties($(this).locationpicker("map").map)
	},
	oninitialized: function(e) {
		$(e).locationpicker("map").location.addressComponents
	}
}), $(".slider-selection").trigger("click"), $("#closeMap").on("click", function() {
	$("#listCol").removeClass("col-md-7"), $("#listCol").addClass("col-md-12"), $("#mapCol").addClass("d-none"), $("#showMap").removeClass("d-none"), allowRefresh = !0, loadPage, getProperties($("#map_view").locationpicker("map").map)
}), $("#showMap").on("click", function() {
	$("#listCol").removeClass("col-md-12"), $("#listCol").addClass("col-md-7"), $("#mapCol").removeClass("d-none"), $("#showMap").addClass("d-none"), allowRefresh = !0, loadPage, getProperties($("#map_view").locationpicker("map").map)
}), $(window).on("load", function() {
	allowRefresh = !0, loadPage, getProperties($("#map_view").locationpicker("map").map)
}), $(document).on("click", ".dropdown-menu-price", function(e) {
	e.stopPropagation()
});